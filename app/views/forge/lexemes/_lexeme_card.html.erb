<div class="bg-white shadow rounded-lg p-4 flex justify-between items-start gap-4">
  <%# Левая часть (основная кликабельная ссылка) %>
  <%= link_to forge_lexeme_path(lexeme), class: "flex-grow group" do %>

    <%# -- ВЕРХНЯЯ СТРОКА -- %>
    <div class="flex flex-wrap items-center gap-x-3 gap-y-2">
      <%# Название и транскрипция %>
      <h2 class="font-semibold text-lg text-blue-700 group-hover:text-blue-900 group-hover:underline">
        <%= lexeme.spelling %>
        <% if lexeme.words.first&.transcription.present? %>
          <span class="ml-2 font-normal text-gray-500 text-base">[<%= lexeme.words.first.transcription %>]</span>
        <% end %>
      </h2>

      <% if lexeme.morphemes.any? %>
        <div class="flex items-center gap-x-1.5">
          <% lexeme.morphemes.each do |morpheme| %>
            <% morphemable = morpheme.morphemable %>
            <%# Определяем классы для цвета в зависимости от типа морфемы %>
            <% color_classes = morphemable.is_a?(Root) ? 'bg-blue-100 text-black text-black border border-blue-500' : 'bg-green-100 text-black text-black border border-green-500' %>

            <%# Таблетка с полным набором стилей Tailwind, чтобы гарантировать результат %>
            <span class="inline-block px-3 py-1 rounded-full text-sm font-medium <%= color_classes %>">
              <%= morphemable.text %>
            </span>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="mt-4 space-y-3">
      <% lexeme.words.each_with_index do |word, index| %>
        <div class="<%= 'border-t border-gray-200 pt-3 mt-3' if index > 0 %>">
          <div class="flex items-baseline gap-3">
            <span class="font-bold text-gray-500"><%= index + 1 %>.</span>
            <span class="text-sm text-gray-600"><%= word.parts_of_speech.map(&:code).join(', ').presence || 'н/д' %></span>
          </div>
          <div class="prose text-gray-800 mt-1 pl-6">
            <%= render_markdown(word.definition.presence) || content_tag(:span, "Нет определения", class: "italic text-gray-400") %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <div class="flex-shrink-0 w-full md:w-auto text-left md:text-right self-start">
    <div class="text-sm text-gray-500 italic mb-2">
      <%= pluralize(lexeme.words.count, 'meaning') %>
    </div>
    <div class="text-sm">
      <%= link_to 'Edit', edit_forge_lexeme_path(lexeme), class: 'text-xs inline-block px-3 py-1 border border-blue-600 bg-blue-100 hover:bg-blue-300 rounded' %>
      <span class="mx-1 text-gray-600">|</span>
      <%= link_to 'Delete', forge_lexeme_path(lexeme), data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' }, class: 'text-xs inline-block px-3 py-1 border bg-red-100 hover:bg-red-300 rounded' %>
    </div>
  </div>
</div>