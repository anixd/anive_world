<%#= form_with(model: model, scope: :word, url: url, class: "space-y-6") do |form| %>
  <%= form_with(model: object, scope: :word, class: "space-y-6") do |form| %>
  <%# ... вывод ошибок ... %>

  <div class="space-y-4 bg-gray-50 p-4 rounded-lg border">
    <h3 class="font-semibold text-lg border-b pb-2 mb-4">Meaning Details</h3>
    <div>
      <%= form.label :definition, "Definition/Translation", class: "block font-bold mb-1" %>
      <%= form.text_area :definition, rows: 3, class: "border rounded w-full p-2" %>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <%= form.label :transcription, "Transcription", class: "block font-bold mb-1" %>
        <%= form.text_field :transcription, class: "border rounded w-full p-2" %>
      </div>
      <div>
        <%= form.label :part_of_speech_ids, "Parts of Speech", class: "block font-bold mb-1" %>
        <div class="border rounded p-2 grid grid-cols-2 md:grid-cols-3 gap-2 bg-white h-32 overflow-y-auto">
          <% if @parts_of_speech.any? %>
            <%= form.collection_check_boxes :part_of_speech_ids, @parts_of_speech, :id, :name do |b| %>
              <label class="flex items-center space-x-2">
                <%= b.check_box(class: "rounded") %>
                <span><%= b.text %></span>
              </label>
            <% end %>
          <% else %>
            <p class="text-gray-500 text-sm col-span-full">No parts of speech defined for this language.</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="space-y-4 bg-gray-50 p-4 rounded-lg border">
    <h3 class="font-semibold text-lg border-b pb-2 mb-4">Origin Details</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <%= form.label :origin_type, "Origin Type", class: "block font-bold mb-1" %>
        <%= form.select :origin_type, Word.origin_types.keys.map { |ot| [ot.humanize, ot] }, { include_blank: 'Not specified' }, { class: "border rounded w-full p-2" } %>
      </div>

      <div data-controller="autocomplete"
           data-autocomplete-url-value="<%= search_forge_words_path(format: :json) %>"
           data-autocomplete-except-id-value="<%= @word.id if @word.persisted? %>">
        <%= form.label :origin_word_id, "Origin Word (Ancestor)", class: "block font-bold mb-1" %>

        <%= form.hidden_field :origin_word_id, data: { autocomplete_target: "hiddenInput" } %>

        <div class="relative">
          <%= text_field_tag :origin_word_search,
                             @word.origin_word&.spelling_with_language,
                             class: "border rounded w-full p-2",
                             placeholder: "Start typing a word...",
                             data: {
                               autocomplete_target: "input",
                               action: "input->autocomplete#debouncedSearch"
                             } %>

          <button type="button" class="absolute inset-y-0 right-0 px-3 text-gray-500 hover:text-gray-800 hidden"
                  data-autocomplete-target="clearButton"
                  data-action="click->autocomplete#clear"
                  title="Clear selection">
            &times;
          </button>
        </div>

        <div class="relative">
          <div data-autocomplete-target="results"
               class="absolute top-0 left-0 right-0 z-10 bg-white border rounded-b-lg shadow-lg hidden max-h-60 overflow-y-auto">
            <%# Результаты будут вставлены сюда JavaScript'ом %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="space-y-4 bg-gray-50 p-4 rounded-lg border">
    <h3 class="font-semibold text-lg border-b pb-2 mb-4">Etymology</h3>
    <%= form.fields_for :etymology do |etymology_form| %>
      <div>
        <%= etymology_form.label :explanation, "Explanation", class: "block font-bold mb-1" %>
        <%= etymology_form.text_area :explanation, rows: 12, class: "border rounded w-full p-2" %>
        <p class="text-xs text-gray-500 mt-1">Main text of the etymological note. Markdown is supported.</p>
      </div>
      <div>
        <%= etymology_form.label :comment, "Comment", class: "block font-bold mb-1" %>
        <%= etymology_form.text_area :comment, rows: 6, class: "border rounded w-full p-2" %>
        <p class="text-xs text-gray-500 mt-1">Optional internal comment.</p>
      </div>
    <% end %>
  </div>


  <div class="actions mt-6">
    <%= form.submit "Save Meaning", class: "bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded cursor-pointer" %>
  </div>
<% end %>
