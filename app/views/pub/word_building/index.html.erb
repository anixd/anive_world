<% content_for :title, "#{@language.name} Word-building" %>

<%= render 'pub/shared/search_block' %>

<div class="bg-white p-6 rounded-lg shadow-md">
  <div class="mb-6">
    <%= render 'pub/shared/breadcrumbs', crumbs: [
      { title: "Languages", path: pub_languages_path },
      { title: @language.name, path: pub_language_path(@language) },
      { title: "Word-building" }
    ] %>
  </div>

  <div class="border-b pb-4 mb-6">
    <div class="flex items-baseline gap-4">
      <h1 class="text-3xl font-bold"><%= @language.name %>: Word-building</h1>
      <span class="font-mono text-base bg-blue-100 text-blue-800 px-2 py-1 rounded-md"><%= @pagy.count %> total</span>
    </div>
    <p class="mt-2 text-gray-600">The basic components for constructing words.</p>
  </div>

  <div class="mb-6">
    <div class="flex rounded-lg border overflow-hidden">
      <%# Таб для корней %>
      <%= link_to "Roots", url_for(tab: 'roots'),
                  class: "flex-1 py-2 px-4 text-center font-medium transition-colors #{ @active_tab == 'roots' ? 'bg-blue-600 text-white' : 'bg-gray-50 text-gray-700 hover:bg-gray-100' }" %>

      <%# Таб для аффиксов %>
      <%= link_to "Affixes", url_for(tab: 'affixes'),
                  class: "flex-1 py-2 px-4 text-center font-medium transition-colors #{ @active_tab == 'affixes' ? 'bg-blue-600 text-white' : 'bg-gray-50 text-gray-700 hover:bg-gray-100' }" %>
    </div>
  </div>

  <% if @active_tab == 'affixes' && @affix_categories.any? %>
    <div class="flex items-center flex-wrap gap-2 mb-6 border-b pb-3">
      <span class="text-sm font-medium text-gray-600">Filter by category:</span>

      <% all_active_class = params[:category_id].blank? ? "bg-blue-600 text-white font-semibold" : "bg-gray-100 text-gray-700 hover:bg-gray-200" %>
      <%= link_to "All", url_for(tab: 'affixes'), class: "px-3 py-1 rounded-full text-sm #{all_active_class}" %>

      <% @affix_categories.each do |category| %>
        <% active_class = (params[:category_id].to_s == category.id.to_s) ? "bg-blue-600 text-white font-semibold" : "bg-gray-100 text-gray-700 hover:bg-gray-200" %>
        <%= link_to category.name, url_for(tab: 'affixes', category_id: category.id), class: "px-3 py-1 rounded-full text-sm #{active_class}" %>
      <% end %>
    </div>
  <% end %>

  <div>
    <% if @active_tab == 'roots' %>
      <%# roots %>
      <%= render "shared/pagination_controls", pagy: @pagy %>
      <section class="mt-4">
        <div class="flex flex-col">
          <% if @roots.any? %>
            <% @roots.each do |root| %>
              <%= link_to pub_language_root_path(@language, root), class: "block py-3 border-b hover:bg-gray-50 group" do %>
                <h3 class="font-bold text-lg font-mono text-blue-800 group-hover:underline"><%= root.text %></h3>
                <div class="prose prose-sm max-w-none text-gray-700 mt-1" data-controller="wikilink-preview">
                  <%= render_markdown(root.meaning.to_s) %>
                </div>
              <% end %>
            <% end %>
          <% else %>
            <p class="text-gray-500 italic">No published roots for this language yet.</p>
          <% end %>
        </div>
      </section>

    <% elsif @active_tab == 'affixes' %>
      <%# affixes %>
      <%= render "shared/pagination_controls", pagy: @pagy %>
      <section class="mt-4">
        <div class="flex flex-col">
          <% if @affixes.any? %>
            <% @affixes.each do |affix| %>
              <%= link_to pub_language_affix_path(@language, affix), class: "block py-3 border-b hover:bg-gray-50 group" do %>
                <div class="flex items-baseline gap-2">
                  <h3 class="font-bold text-lg font-mono text-green-800 group-hover:underline"><%= affix.text %></h3>

                  <span class="bg-gray-200 text-gray-700 text-xs font-medium px-2 py-0.5 rounded-full"><%= affix.affix_type %></span>

                  <% if affix.affix_category.present? %>
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2 py-0.5 rounded-full">
                      <%= affix.affix_category.name %>
                    </span>
                  <% end %>
                </div>
                <div class="prose prose-sm max-w-none text-gray-700 mt-1" data-controller="wikilink-preview">
                  <%= render_markdown(affix.meaning.to_s) %>
                </div>
              <% end %>
            <% end %>
          <% else %>
            <p class="text-gray-500 italic">No published affixes for this language yet.</p>
          <% end %>
        </div>
      </section>
    <% end %>

    <div class="mt-6">
      <%= render "shared/pagination_controls", pagy: @pagy %>
    </div>
  </div>
</div>
