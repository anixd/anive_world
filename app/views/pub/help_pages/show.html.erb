<% content_for :title, @help_page.title %>

<%= render 'pub/shared/search_block' %>

<div class="bg-white p-6 md:p-8 rounded-lg shadow-md">
  <div class="mb-6">
    <%
      crumbs = [{ title: "Help", path: pub_help_pages_path }]
      # Динамически строим хлебные крошки, идя вверх по иерархии
      @help_page.parent.tap { |p| crumbs << { title: p.title, path: pub_help_page_path(p) } if p }
      crumbs << { title: @help_page.title }
    %>
    <%= render 'pub/shared/breadcrumbs', crumbs: crumbs %>
  </div>

  <header class="border-b pb-4 mb-6">
    <h1 class="text-4xl font-bold text-gray-900"><%= @help_page.title %></h1>
  </header>

  <div class="prose max-w-none mb-8" data-controller="wikilink-preview">
    <%= render_markdown(@help_page.body) %>
  </div>

  <% if @help_page.children.published.any? %>
    <div class="mt-8 pt-6 border-t">
      <h3 class="text-2xl font-semibold mb-4 text-gray-800">Sub-topics in this section</h3>
      <ul class="list-disc list-inside space-y-2">
        <% @help_page.children.published.order(:title).each do |child| %>
          <li>
            <%= link_to child.title, pub_help_page_path(child), class: "text-blue-600 hover:underline" %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="border-t pt-6 mt-8">
    <%= render 'pub/shared/content_header', back_path: pub_help_pages_path, back_path_text: 'Back to Help Index' %>
  </div>
</div>
